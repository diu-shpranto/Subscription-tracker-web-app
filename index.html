<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ðŸŽ¥ Premium Trial Tracker</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<!-- Chart.js for data visualization -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root {
  --primary: #FF0000;
  --primary-dark: #CC0000;
  --secondary: #4285F4;
  --success: #34A853;
  --warning: #FBBC05;
  --danger: #EA4335;
  --info: #4285F4;
  
  --bg-light: #f8f9fa;
  --bg-card-light: #ffffff;
  --text-primary-light: #202124;
  --text-secondary-light: #5f6368;
  --border-light: #dadce0;
  
  --bg-dark: #1E1E1E;
  --bg-card-dark: #2D2D2D;
  --text-primary-dark: #E8EAED;
  --text-secondary-dark: #9AA0A6;
  --border-dark: #3C4043;
  
  --shadow-sm: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.08);
  --shadow-md: 0 4px 6px rgba(0,0,0,0.1), 0 1px 3px rgba(0,0,0,0.08);
  --shadow-lg: 0 10px 25px rgba(0,0,0,0.1), 0 5px 10px rgba(0,0,0,0.05);
  --radius: 12px;
  --radius-sm: 8px;
  --transition: all 0.3s ease;
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: 'Inter', sans-serif;
  background-color: var(--bg-light);
  color: var(--text-primary-light);
  max-width: 1400px;
  margin: 0 auto;
  padding: 20px;
  transition: var(--transition);
  line-height: 1.6;
}

body.dark {
  background-color: var(--bg-dark);
  color: var(--text-primary-dark);
}

/* Header Styles */
.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 30px;
  padding-bottom: 15px;
  border-bottom: 1px solid var(--border-light);
}

body.dark .header {
  border-bottom-color: var(--border-dark);
}

.logo {
  display: flex;
  align-items: center;
  gap: 12px;
}

.logo-icon {
  font-size: 28px;
  color: var(--primary);
}

.logo-text {
  font-size: 24px;
  font-weight: 700;
  background: linear-gradient(45deg, var(--primary), var(--danger));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.header-actions {
  display: flex;
  gap: 12px;
  align-items: center;
}

/* Dashboard Section */
.dashboard {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 20px;
  margin-bottom: 24px;
}

.dashboard-card {
  background: var(--bg-card-light);
  padding: 20px;
  border-radius: var(--radius);
  box-shadow: var(--shadow-md);
  transition: var(--transition);
}

body.dark .dashboard-card {
  background: var(--bg-card-dark);
}

.dashboard-card h3 {
  font-size: 16px;
  font-weight: 600;
  margin-bottom: 16px;
  color: var(--text-secondary-light);
  display: flex;
  align-items: center;
  gap: 8px;
}

body.dark .dashboard-card h3 {
  color: var(--text-secondary-dark);
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 12px;
}

.stat-item {
  text-align: center;
  padding: 12px;
  border-radius: var(--radius-sm);
  background: var(--bg-light);
  transition: var(--transition);
}

body.dark .stat-item {
  background: var(--bg-dark);
}

.stat-value {
  font-size: 24px;
  font-weight: 700;
  margin-bottom: 4px;
}

.stat-label {
  font-size: 12px;
  color: var(--text-secondary-light);
}

body.dark .stat-label {
  color: var(--text-secondary-dark);
}

.stat-active .stat-value {
  color: var(--success);
}

.stat-ending .stat-value {
  color: var(--warning);
}

.stat-ended .stat-value {
  color: var(--danger);
}

.chart-container {
  position: relative;
  height: 200px;
  width: 100%;
}

/* Control Panel */
.control-panel {
  background: var(--bg-card-light);
  padding: 24px;
  border-radius: var(--radius);
  box-shadow: var(--shadow-md);
  margin-bottom: 24px;
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  transition: var(--transition);
}

body.dark .control-panel {
  background: var(--bg-card-dark);
  box-shadow: 0 4px 6px rgba(0,0,0,0.25);
}

.form-group {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

label {
  font-weight: 500;
  font-size: 14px;
  color: var(--text-secondary-light);
  display: flex;
  align-items: center;
  gap: 8px;
}

body.dark label {
  color: var(--text-secondary-dark);
}

.input-icon {
  color: var(--primary);
}

input, select, textarea {
  padding: 12px 16px;
  border: 1px solid var(--border-light);
  border-radius: var(--radius-sm);
  font-size: 15px;
  transition: var(--transition);
  background: var(--bg-card-light);
  color: var(--text-primary-light);
}

body.dark input, 
body.dark select,
body.dark textarea {
  background: var(--bg-dark);
  color: var(--text-primary-dark);
  border-color: var(--border-dark);
}

input:focus, select:focus, textarea:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(255, 0, 0, 0.15);
}

.btn {
  padding: 12px 20px;
  border: none;
  border-radius: var(--radius-sm);
  font-weight: 500;
  cursor: pointer;
  transition: var(--transition);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.btn-primary {
  background: var(--primary);
  color: white;
}

.btn-primary:hover {
  background: var(--primary-dark);
  transform: translateY(-2px);
  box-shadow: var(--shadow-md);
}

.btn-secondary {
  background: var(--secondary);
  color: white;
}

.btn-secondary:hover {
  background: #3367d6;
  transform: translateY(-2px);
  box-shadow: var(--shadow-md);
}

.btn-outline {
  background: transparent;
  border: 1px solid var(--border-light);
  color: var(--text-secondary-light);
}

body.dark .btn-outline {
  border-color: var(--border-dark);
  color: var(--text-secondary-dark);
}

.btn-outline:hover {
  background: rgba(0,0,0,0.05);
}

body.dark .btn-outline:hover {
  background: rgba(255,255,255,0.05);
}

.btn-sm {
  padding: 8px 12px;
  font-size: 13px;
}

/* Action Bar */
.action-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 24px;
  flex-wrap: wrap;
  gap: 16px;
}

.search-container {
  position: relative;
  flex: 1;
  max-width: 400px;
}

.search-container i {
  position: absolute;
  left: 16px;
  top: 50%;
  transform: translateY(-50%);
  color: var(--text-secondary-light);
}

body.dark .search-container i {
  color: var(--text-secondary-dark);
}

.search-input {
  padding-left: 44px;
  width: 100%;
}

.filter-container {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
}

.filter-select {
  min-width: 120px;
}

.export-import {
  display: flex;
  gap: 12px;
}

.view-toggle {
  display: flex;
  border: 1px solid var(--border-light);
  border-radius: var(--radius-sm);
  overflow: hidden;
}

body.dark .view-toggle {
  border-color: var(--border-dark);
}

.view-btn {
  padding: 10px 12px;
  background: var(--bg-card-light);
  border: none;
  color: var(--text-secondary-light);
  cursor: pointer;
  transition: var(--transition);
}

body.dark .view-btn {
  background: var(--bg-card-dark);
  color: var(--text-secondary-dark);
}

.view-btn.active {
  background: var(--primary);
  color: white;
}

/* Accounts Table */
.accounts-table {
  width: 100%;
  border-collapse: collapse;
  background: var(--bg-card-light);
  box-shadow: var(--shadow-md);
  border-radius: var(--radius);
  overflow: hidden;
  margin-bottom: 40px;
  transition: var(--transition);
}

body.dark .accounts-table {
  background: var(--bg-card-dark);
}

.accounts-table th,
.accounts-table td {
  padding: 16px;
  text-align: left;
  border-bottom: 1px solid var(--border-light);
  transition: var(--transition);
}

body.dark .accounts-table th,
body.dark .accounts-table td {
  border-color: var(--border-dark);
}

.accounts-table th {
  background: var(--bg-light);
  font-weight: 600;
  color: var(--text-primary-light);
  position: sticky;
  top: 0;
}

body.dark .accounts-table th {
  background: var(--bg-dark);
  color: var(--text-primary-dark);
}

.accounts-table tr:last-child td {
  border-bottom: none;
}

.accounts-table tr:hover {
  background: rgba(0,0,0,0.02);
  transition: var(--transition);
}

body.dark .accounts-table tr:hover {
  background: rgba(255,255,255,0.02);
}

/* Cards View */
.accounts-cards {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 20px;
  margin-bottom: 40px;
}

.account-card {
  background: var(--bg-card-light);
  border-radius: var(--radius);
  padding: 20px;
  box-shadow: var(--shadow-md);
  transition: var(--transition);
  position: relative;
}

body.dark .account-card {
  background: var(--bg-card-dark);
}

.account-card:hover {
  transform: translateY(-5px);
  box-shadow: var(--shadow-lg);
}

.account-card-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 16px;
}

.account-email {
  font-weight: 600;
  margin-bottom: 4px;
  word-break: break-all;
}

.account-tags {
  display: flex;
  gap: 6px;
  margin-top: 8px;
  flex-wrap: wrap;
}

.account-tag {
  padding: 4px 8px;
  background: var(--bg-light);
  border-radius: 100px;
  font-size: 11px;
  font-weight: 500;
  color: var(--text-secondary-light);
}

body.dark .account-tag {
  background: var(--bg-dark);
  color: var(--text-secondary-dark);
}

.account-dates {
  margin-bottom: 16px;
}

.account-date {
  display: flex;
  justify-content: space-between;
  font-size: 13px;
  margin-bottom: 6px;
  color: var(--text-secondary-light);
}

body.dark .account-date {
  color: var(--text-secondary-dark);
}

.account-date-label {
  font-weight: 500;
}

.account-progress {
  margin: 16px 0;
}

.account-actions {
  display: flex;
  justify-content: flex-end;
  gap: 8px;
  margin-top: 16px;
}

/* Status Indicator */
.status-indicator {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
}

.status-active {
  background: rgba(52, 168, 83, 0.15);
  color: var(--success);
}

.status-ending {
  background: rgba(251, 188, 5, 0.15);
  color: var(--warning);
}

.status-ended {
  background: rgba(234, 67, 53, 0.15);
  color: var(--danger);
}

.status-indicator::before {
  content: "";
  width: 8px;
  height: 8px;
  border-radius: 50%;
  display: inline-block;
}

.status-active::before {
  background: var(--success);
}

.status-ending::before {
  background: var(--warning);
}

.status-ended::before {
  background: var(--danger);
}

/* Time Left */
.time-left {
  font-family: 'SF Mono', 'Roboto Mono', monospace;
  font-weight: 600;
  font-size: 14px;
  color: var(--text-primary-light);
}

body.dark .time-left {
  color: var(--text-primary-dark);
}

/* Action Buttons */
.action-buttons {
  display: flex;
  gap: 8px;
}

.icon-btn {
  background: transparent;
  border: none;
  width: 32px;
  height: 32px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: var(--transition);
  color: var(--text-secondary-light);
}

body.dark .icon-btn {
  color: var(--text-secondary-dark);
}

.icon-btn:hover {
  background: rgba(0,0,0,0.05);
  color: var(--primary);
}

body.dark .icon-btn:hover {
  background: rgba(255,255,255,0.05);
}

/* Progress Bar */
.progress-container {
  width: 100%;
  background: var(--border-light);
  border-radius: 100px;
  height: 6px;
  margin-top: 6px;
  overflow: hidden;
  position: relative;
}

body.dark .progress-container {
  background: var(--border-dark);
}

.progress-bar {
  height: 100%;
  border-radius: 100px;
  width: 0%;
  transition: width 1s ease;
  position: relative;
}

.progress-active {
  background: linear-gradient(90deg, var(--success), #66BB6A);
}

.progress-ending {
  background: linear-gradient(90deg, var(--warning), #FFCA28);
}

.progress-ended {
  background: linear-gradient(90deg, var(--danger), #EF5350);
}

/* Empty State */
.empty-state {
  text-align: center;
  padding: 60px 20px;
  color: var(--text-secondary-light);
  grid-column: 1 / -1;
}

body.dark .empty-state {
  color: var(--text-secondary-dark);
}

.empty-icon {
  font-size: 64px;
  margin-bottom: 16px;
  opacity: 0.5;
}

.empty-title {
  font-size: 20px;
  font-weight: 600;
  margin-bottom: 8px;
}

.empty-desc {
  max-width: 500px;
  margin: 0 auto 24px;
}

/* Dark Mode Toggle */
.dark-mode-toggle {
  position: fixed;
  bottom: 24px;
  right: 24px;
  width: 56px;
  height: 56px;
  border-radius: 50%;
  background: var(--bg-card-light);
  color: var(--text-primary-light);
  border: 1px solid var(--border-light);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  box-shadow: var(--shadow-lg);
  z-index: 100;
  transition: var(--transition);
}

body.dark .dark-mode-toggle {
  background: var(--bg-card-dark);
  color: var(--text-primary-dark);
  border-color: var(--border-dark);
}

.dark-mode-toggle:hover {
  transform: rotate(15deg);
}

/* Modal */
.modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.5);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 1000;
  padding: 20px;
  backdrop-filter: blur(4px);
}

.modal-content {
  background: var(--bg-card-light);
  padding: 24px;
  border-radius: var(--radius);
  width: 100%;
  max-width: 500px;
  box-shadow: var(--shadow-lg);
  transition: var(--transition);
  max-height: 90vh;
  overflow-y: auto;
}

body.dark .modal-content {
  background: var(--bg-card-dark);
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.modal-title {
  font-size: 20px;
  font-weight: 600;
}

.modal-close {
  background: transparent;
  border: none;
  font-size: 24px;
  cursor: pointer;
  color: var(--text-secondary-light);
  transition: var(--transition);
}

body.dark .modal-close {
  color: var(--text-secondary-dark);
}

.modal-close:hover {
  color: var(--primary);
}

.modal-body {
  display: flex;
  flex-direction: column;
  gap: 16px;
  margin-bottom: 24px;
}

.modal-footer {
  display: flex;
  justify-content: flex-end;
  gap: 12px;
}

.modal-tabs {
  display: flex;
  border-bottom: 1px solid var(--border-light);
  margin-bottom: 20px;
}

body.dark .modal-tabs {
  border-color: var(--border-dark);
}

.modal-tab {
  padding: 10px 16px;
  background: none;
  border: none;
  cursor: pointer;
  font-weight: 500;
  color: var(--text-secondary-light);
  border-bottom: 2px solid transparent;
}

body.dark .modal-tab {
  color: var(--text-secondary-dark);
}

.modal-tab.active {
  color: var(--primary);
  border-bottom-color: var(--primary);
}

.tab-content {
  display: none;
}

.tab-content.active {
  display: block;
}

.tag-input-container {
  display: flex;
  gap: 8px;
}

.tag-input {
  flex: 1;
}

.tags-list {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-top: 12px;
}

.tag {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 6px 12px;
  background: var(--bg-light);
  border-radius: 100px;
  font-size: 12px;
  font-weight: 500;
}

body.dark .tag {
  background: var(--bg-dark);
}

.tag-remove {
  background: none;
  border: none;
  cursor: pointer;
  font-size: 14px;
  color: var(--text-secondary-light);
}

body.dark .tag-remove {
  color: var(--text-secondary-dark);
}

/* Toast Notification */
.toast-container {
  position: fixed;
  top: 24px;
  right: 24px;
  z-index: 1100;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.toast {
  padding: 16px 20px;
  border-radius: var(--radius-sm);
  background: var(--bg-card-light);
  color: var(--text-primary-light);
  box-shadow: var(--shadow-lg);
  display: flex;
  align-items: center;
  gap: 12px;
  animation: slideIn 0.3s ease;
  max-width: 350px;
}

body.dark .toast {
  background: var(--bg-card-dark);
  color: var(--text-primary-dark);
}

.toast.success {
  border-left: 4px solid var(--success);
}

.toast.error {
  border-left: 4px solid var(--danger);
}

.toast.info {
  border-left: 4px solid var(--info);
}

.toast.warning {
  border-left: 4px solid var(--warning);
}

.toast-icon {
  font-size: 20px;
}

.toast.success .toast-icon {
  color: var(--success);
}

.toast.error .toast-icon {
  color: var(--danger);
}

.toast.info .toast-icon {
  color: var(--info);
}

.toast.warning .toast-icon {
  color: var(--warning);
}

.toast-message {
  flex: 1;
  font-size: 14px;
}

.toast-close {
  background: transparent;
  border: none;
  cursor: pointer;
  color: var(--text-secondary-light);
  font-size: 18px;
}

body.dark .toast-close {
  color: var(--text-secondary-dark);
}

@keyframes slideIn {
  from {
    transform: translateX(100%);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

/* Settings Panel */
.settings-panel {
  background: var(--bg-card-light);
  padding: 24px;
  border-radius: var(--radius);
  box-shadow: var(--shadow-md);
  margin-bottom: 24px;
  transition: var(--transition);
}

body.dark .settings-panel {
  background: var(--bg-card-dark);
}

.settings-group {
  margin-bottom: 24px;
}

.settings-group:last-child {
  margin-bottom: 0;
}

.settings-title {
  font-size: 18px;
  font-weight: 600;
  margin-bottom: 16px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.setting-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 0;
  border-bottom: 1px solid var(--border-light);
}

body.dark .setting-item {
  border-color: var(--border-dark);
}

.setting-item:last-child {
  border-bottom: none;
}

.setting-label {
  font-weight: 500;
}

.setting-description {
  font-size: 13px;
  color: var(--text-secondary-light);
  margin-top: 4px;
}

body.dark .setting-description {
  color: var(--text-secondary-dark);
}

/* Toggle Switch */
.toggle-switch {
  position: relative;
  display: inline-block;
  width: 50px;
  height: 24px;
}

.toggle-switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

.toggle-slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #ccc;
  transition: .4s;
  border-radius: 24px;
}

.toggle-slider:before {
  position: absolute;
  content: "";
  height: 16px;
  width: 16px;
  left: 4px;
  bottom: 4px;
  background-color: white;
  transition: .4s;
  border-radius: 50%;
}

input:checked + .toggle-slider {
  background-color: var(--primary);
}

input:checked + .toggle-slider:before {
  transform: translateX(26px);
}

/* Responsive Adjustments */
@media (max-width: 1200px) {
  .accounts-table {
    display: block;
    overflow-x: auto;
  }
}

@media (max-width: 992px) {
  .dashboard {
    grid-template-columns: 1fr;
  }
}

@media (max-width: 768px) {
  .header {
    flex-direction: column;
    align-items: flex-start;
    gap: 16px;
  }
  
  .action-bar {
    flex-direction: column;
    align-items: stretch;
  }
  
  .search-container {
    max-width: 100%;
  }
  
  .control-panel {
    grid-template-columns: 1fr;
  }
  
  .export-import {
    flex-direction: column;
  }
  
  .accounts-table {
    font-size: 14px;
  }
  
  .accounts-table th,
  .accounts-table td {
    padding: 12px 8px;
  }
  
  .time-left {
    font-size: 12px;
  }
  
  .filter-container {
    flex-direction: column;
    width: 100%;
  }
  
  .filter-select {
    width: 100%;
  }
}

@media (max-width: 480px) {
  body {
    padding: 16px;
  }
  
  .modal-content {
    padding: 20px 16px;
  }
  
  .modal-footer {
    flex-direction: column;
  }
  
  .btn {
    width: 100%;
  }
  
  .stats-grid {
    grid-template-columns: 1fr;
  }
  
  .account-card {
    padding: 16px;
  }
}
</style>
</head>
<body>

<div class="header">
  <div class="logo">
    <div class="logo-icon"><i class="fas fa-film"></i></div>
    <div class="logo-text">Premium Trial Tracker</div>
  </div>
  <div class="header-actions">
    <button id="dashboardBtn" class="btn btn-outline btn-sm"><i class="fas fa-chart-pie"></i> Dashboard</button>
    <button id="settingsBtn" class="btn btn-outline btn-sm"><i class="fas fa-cog"></i> Settings</button>
    <div class="dark-mode-toggle" id="darkModeToggle">
      <i class="fas fa-moon"></i>
    </div>
  </div>
</div>

<div id="dashboardSection" class="dashboard" style="display: none;">
  <div class="dashboard-card">
    <h3><i class="fas fa-chart-bar"></i> Trial Status Overview</h3>
    <div class="chart-container">
      <canvas id="statusChart"></canvas>
    </div>
  </div>
  <div class="dashboard-card">
    <h3><i class="fas fa-calendar"></i> Expiration Timeline</h3>
    <div class="chart-container">
      <canvas id="timelineChart"></canvas>
    </div>
  </div>
  <div class="dashboard-card">
    <h3><i class="fas fa-chart-pie"></i> Statistics</h3>
    <div class="stats-grid">
      <div class="stat-item stat-active">
        <div class="stat-value" id="activeCount">0</div>
        <div class="stat-label">Active</div>
      </div>
      <div class="stat-item stat-ending">
        <div class="stat-value" id="endingCount">0</div>
        <div class="stat-label">Ending Soon</div>
      </div>
      <div class="stat-item stat-ended">
        <div class="stat-value" id="endedCount">0</div>
        <div class="stat-label">Expired</div>
      </div>
    </div>
    <div class="stats-grid" style="margin-top: 16px;">
      <div class="stat-item">
        <div class="stat-value" id="totalCount">0</div>
        <div class="stat-label">Total Trials</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="avgDuration">0</div>
        <div class="stat-label">Avg. Duration</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="daysSaved">0</div>
        <div class="stat-label">Days Saved</div>
      </div>
    </div>
  </div>
</div>

<div id="settingsSection" class="settings-panel" style="display: none;">
  <div class="settings-group">
    <h3 class="settings-title"><i class="fas fa-bell"></i> Notifications</h3>
    <div class="setting-item">
      <div>
        <div class="setting-label">Browser Notifications</div>
        <div class="setting-description">Show browser notifications for expiring trials</div>
      </div>
      <label class="toggle-switch">
        <input type="checkbox" id="browserNotifications">
        <span class="toggle-slider"></span>
      </label>
    </div>
    <div class="setting-item">
      <div>
        <div class="setting-label">Notification Time</div>
        <div class="setting-description">When to send notifications before expiration</div>
      </div>
      <select id="notificationTime" class="filter-select">
        <option value="1">1 hour before</option>
        <option value="3">3 hours before</option>
        <option value="6">6 hours before</option>
        <option value="12">12 hours before</option>
        <option value="24" selected>1 day before</option>
        <option value="72">3 days before</option>
      </select>
    </div>
  </div>
  
  <div class="settings-group">
    <h3 class="settings-title"><i class="fas fa-shield-alt"></i> Security</h3>
    <div class="setting-item">
      <div>
        <div class="setting-label">Data Encryption</div>
        <div class="setting-description">Encrypt your data with a password</div>
      </div>
      <label class="toggle-switch">
        <input type="checkbox" id="dataEncryption">
        <span class="toggle-slider"></span>
      </label>
    </div>
    <div class="setting-item" id="encryptionPasswordItem" style="display: none;">
      <div>
        <div class="setting-label">Encryption Password</div>
        <div class="setting-description">Set a password to encrypt your data</div>
      </div>
      <button id="setPasswordBtn" class="btn btn-outline btn-sm">Set Password</button>
    </div>
  </div>
  
  <div class="settings-group">
    <h3 class="settings-title"><i class="fas fa-cloud"></i> Backup & Sync</h3>
    <div class="setting-item">
      <div>
        <div class="setting-label">Auto Backup</div>
        <div class="setting-description">Automatically backup your data daily</div>
      </div>
      <label class="toggle-switch">
        <input type="checkbox" id="autoBackup">
        <span class="toggle-slider"></span>
      </label>
    </div>
    <div class="setting-item">
      <div>
        <div class="setting-label">Backup to Google Drive</div>
        <div class="setting-description">Sync your data with Google Drive</div>
      </div>
      <button id="googleDriveBtn" class="btn btn-outline btn-sm">Connect</button>
    </div>
  </div>
  
  <div class="settings-group">
    <h3 class="settings-title"><i class="fas fa-language"></i> Language</h3>
    <div class="setting-item">
      <div>
        <div class="setting-label">App Language</div>
        <div class="setting-description">Change the language of the interface</div>
      </div>
      <select id="languageSelect" class="filter-select">
        <option value="en" selected>English</option>
        <option value="es">EspaÃ±ol</option>
        <option value="fr">FranÃ§ais</option>
        <option value="de">Deutsch</option>
        <option value="pt">PortuguÃªs</option>
      </select>
    </div>
  </div>
</div>

<div class="control-panel">
  <div class="form-group">
    <label for="email"><i class="fas fa-envelope input-icon"></i> Gmail Address</label>
    <input type="email" id="email" placeholder="example@gmail.com" required>
  </div>
  <div class="form-group">
    <label for="startDate"><i class="fas fa-calendar-alt input-icon"></i> Trial Start Date & Time</label>
    <input type="datetime-local" id="startDate" required>
  </div>
  <div class="form-group">
    <label for="duration"><i class="fas fa-clock input-icon"></i> Trial Duration (days)</label>
    <input type="number" id="duration" min="1" value="30" required>
  </div>
  <div class="form-group">
    <label for="tags"><i class="fas fa-tags input-icon"></i> Tags (optional)</label>
    <input type="text" id="tags" placeholder="Enter tags separated by commas">
  </div>
  <div class="form-group" style="justify-content: flex-end;">
    <button id="addAccount" class="btn btn-primary"><i class="fas fa-plus"></i> Add Account</button>
  </div>
</div>

<div class="action-bar">
  <div class="search-container">
    <i class="fas fa-search"></i>
    <input type="text" id="searchInput" class="search-input" placeholder="Search Gmail accounts...">
  </div>
  <div class="filter-container">
    <select id="statusFilter" class="filter-select">
      <option value="all">All Status</option>
      <option value="active">Active</option>
      <option value="ending">Ending Soon</option>
      <option value="ended">Expired</option>
    </select>
    <select id="tagFilter" class="filter-select">
      <option value="all">All Tags</option>
    </select>
  </div>
  <div class="view-toggle">
    <button id="tableViewBtn" class="view-btn active"><i class="fas fa-table"></i></button>
    <button id="cardViewBtn" class="view-btn"><i class="fas fa-th-large"></i></button>
  </div>
  <div class="export-import">
    <button id="exportBtn" class="btn btn-outline"><i class="fas fa-file-export"></i> Export</button>
    <button id="exportCsvBtn" class="btn btn-outline"><i class="fas fa-file-csv"></i> CSV</button>
    <label for="importFile" class="btn btn-outline"><i class="fas fa-file-import"></i> Import</label>
    <input type="file" id="importFile" accept=".json,.csv" style="display: none;">
  </div>
</div>

<table class="accounts-table" id="accountsTable">
  <thead>
    <tr>
      <th>Gmail</th>
      <th>Start Date</th>
      <th>End Date</th>
      <th>Status</th>
      <th>Time Remaining</th>
      <th>Progress</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody id="accountsTableBody">
    <!-- Accounts will be inserted here -->
  </tbody>
</table>

<div class="accounts-cards" id="accountsCards" style="display: none;">
  <!-- Account cards will be inserted here -->
</div>

<div class="empty-state" id="emptyState">
  <div class="empty-icon"><i class="fas fa-inbox"></i></div>
  <h3 class="empty-title">No accounts yet</h3>
  <p class="empty-desc">Add your first trial account to start tracking its expiration date and time remaining.</p>
  <button class="btn btn-primary" id="addFirstAccount"><i class="fas fa-plus"></i> Add Account</button>
</div>

<div id="editModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3 class="modal-title">Edit Account</h3>
      <button class="modal-close">&times;</button>
    </div>
    <div class="modal-body">
      <div class="modal-tabs">
        <button class="modal-tab active" data-tab="details">Details</button>
        <button class="modal-tab" data-tab="tags">Tags</button>
      </div>
      
      <div class="tab-content active" id="detailsTab">
        <div class="form-group">
          <label for="editEmail">Email Address</label>
          <input type="text" id="editEmail">
        </div>
        <div class="form-group">
          <label for="editStartDate">Start Date & Time</label>
          <input type="datetime-local" id="editStartDate">
        </div>
        <div class="form-group">
          <label for="editDuration">Duration (days)</label>
          <input type="number" id="editDuration" value="30">
        </div>
      </div>
      
      <div class="tab-content" id="tagsTab">
        <div class="form-group">
          <label for="editTagsInput">Add Tags</label>
          <div class="tag-input-container">
            <input type="text" id="editTagsInput" class="tag-input" placeholder="Enter a tag">
            <button id="addTagBtn" class="btn btn-primary btn-sm">Add</button>
          </div>
          <div class="tags-list" id="editTagsList">
            <!-- Tags will be added here -->
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button id="cancelEditBtn" class="btn btn-outline">Cancel</button>
      <button id="saveEditBtn" class="btn btn-primary">Save Changes</button>
    </div>
  </div>
</div>

<div id="passwordModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3 class="modal-title">Set Encryption Password</h3>
      <button class="modal-close">&times;</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label for="passwordInput">Password</label>
        <input type="password" id="passwordInput" placeholder="Enter a password">
      </div>
      <div class="form-group">
        <label for="confirmPasswordInput">Confirm Password</label>
        <input type="password" id="confirmPasswordInput" placeholder="Confirm your password">
      </div>
    </div>
    <div class="modal-footer">
      <button id="cancelPasswordBtn" class="btn btn-outline">Cancel</button>
      <button id="savePasswordBtn" class="btn btn-primary">Save Password</button>
    </div>
  </div>
</div>

<div class="toast-container" id="toastContainer"></div>

<script>
// State management
let accounts = [];
let editingIndex = null;
let darkMode = localStorage.getItem('darkMode') === 'true';
let viewMode = localStorage.getItem('viewMode') || 'table';
let settings = {
  browserNotifications: localStorage.getItem('browserNotifications') === 'true',
  notificationTime: parseInt(localStorage.getItem('notificationTime')) || 24,
  dataEncryption: localStorage.getItem('dataEncryption') === 'true',
  encryptionPassword: localStorage.getItem('encryptionPassword') || '',
  autoBackup: localStorage.getItem('autoBackup') === 'true',
  language: localStorage.getItem('language') || 'en'
};

// Chart instances
let statusChart = null;
let timelineChart = null;

// DOM Elements
const elements = {
  emailInput: document.getElementById("email"),
  startDateInput: document.getElementById("startDate"),
  durationInput: document.getElementById("duration"),
  tagsInput: document.getElementById("tags"),
  addAccountBtn: document.getElementById("addAccount"),
  accountsTable: document.getElementById("accountsTable"),
  accountsTableBody: document.getElementById("accountsTableBody"),
  accountsCards: document.getElementById("accountsCards"),
  emptyState: document.getElementById("emptyState"),
  addFirstAccountBtn: document.getElementById("addFirstAccount"),
  editModal: document.getElementById("editModal"),
  editEmail: document.getElementById("editEmail"),
  editStartDate: document.getElementById("editStartDate"),
  editDuration: document.getElementById("editDuration"),
  editTagsInput: document.getElementById("editTagsInput"),
  editTagsList: document.getElementById("editTagsList"),
  addTagBtn: document.getElementById("addTagBtn"),
  saveEditBtn: document.getElementById("saveEditBtn"),
  cancelEditBtn: document.getElementById("cancelEditBtn"),
  modalClose: document.querySelector(".modal-close"),
  exportBtn: document.getElementById("exportBtn"),
  exportCsvBtn: document.getElementById("exportCsvBtn"),
  importFile: document.getElementById("importFile"),
  darkModeToggle: document.getElementById("darkModeToggle"),
  searchInput: document.getElementById("searchInput"),
  toastContainer: document.getElementById("toastContainer"),
  statusFilter: document.getElementById("statusFilter"),
  tagFilter: document.getElementById("tagFilter"),
  tableViewBtn: document.getElementById("tableViewBtn"),
  cardViewBtn: document.getElementById("cardViewBtn"),
  dashboardBtn: document.getElementById("dashboardBtn"),
  dashboardSection: document.getElementById("dashboardSection"),
  settingsBtn: document.getElementById("settingsBtn"),
  settingsSection: document.getElementById("settingsSection"),
  browserNotifications: document.getElementById("browserNotifications"),
  notificationTime: document.getElementById("notificationTime"),
  dataEncryption: document.getElementById("dataEncryption"),
  encryptionPasswordItem: document.getElementById("encryptionPasswordItem"),
  setPasswordBtn: document.getElementById("setPasswordBtn"),
  autoBackup: document.getElementById("autoBackup"),
  googleDriveBtn: document.getElementById("googleDriveBtn"),
  languageSelect: document.getElementById("languageSelect"),
  passwordModal: document.getElementById("passwordModal"),
  passwordInput: document.getElementById("passwordInput"),
  confirmPasswordInput: document.getElementById("confirmPasswordInput"),
  cancelPasswordBtn: document.getElementById("cancelPasswordBtn"),
  savePasswordBtn: document.getElementById("savePasswordBtn"),
  modalTabs: document.querySelectorAll(".modal-tab"),
  tabContents: document.querySelectorAll(".tab-content")
};

// Initialize the app
function init() {
  // Set current datetime as default for start date
  const now = new Date();
  const localDateTime = new Date(now.getTime() - now.getTimezoneOffset() * 60000).toISOString().slice(0, 16);
  elements.startDateInput.value = localDateTime;
  
  // Load data and apply settings
  loadData();
  applySettings();
  setDarkMode(darkMode);
  setViewMode(viewMode);
  renderAccounts();
  updateDashboard();
  
  // Set up event listeners
  setupEventListeners();
  
  // Start the countdown timer
  setInterval(updateTimers, 1000);
  
  // Check for notifications
  setInterval(checkNotifications, 60000); // Check every minute
  
  // Request notification permission
  if ('Notification' in window) {
    Notification.requestPermission();
  }
}

// Set up all event listeners
function setupEventListeners() {
  elements.addAccountBtn.addEventListener("click", addAccount);
  elements.addFirstAccountBtn.addEventListener("click", () => {
    elements.emailInput.focus();
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });
  elements.saveEditBtn.addEventListener("click", saveEdit);
  elements.cancelEditBtn.addEventListener("click", closeEditModal);
  elements.modalClose.addEventListener("click", closeEditModal);
  elements.exportBtn.addEventListener("click", exportAccounts);
  elements.exportCsvBtn.addEventListener("click", exportAccountsCsv);
  elements.importFile.addEventListener("change", importAccounts);
  elements.darkModeToggle.addEventListener("click", toggleDarkMode);
  elements.searchInput.addEventListener("input", filterAccounts);
  elements.statusFilter.addEventListener("change", filterAccounts);
  elements.tagFilter.addEventListener("change", filterAccounts);
  elements.tableViewBtn.addEventListener("click", () => setViewMode('table'));
  elements.cardViewBtn.addEventListener("click", () => setViewMode('cards'));
  elements.dashboardBtn.addEventListener("click", toggleDashboard);
  elements.settingsBtn.addEventListener("click", toggleSettings);
  elements.browserNotifications.addEventListener("change", updateSettings);
  elements.notificationTime.addEventListener("change", updateSettings);
  elements.dataEncryption.addEventListener("change", toggleDataEncryption);
  elements.setPasswordBtn.addEventListener("click", openPasswordModal);
  elements.autoBackup.addEventListener("change", updateSettings);
  elements.googleDriveBtn.addEventListener("click", connectGoogleDrive);
  elements.languageSelect.addEventListener("change", updateSettings);
  elements.cancelPasswordBtn.addEventListener("click", closePasswordModal);
  elements.savePasswordBtn.addEventListener("click", savePassword);
  elements.addTagBtn.addEventListener("click", addTagToEdit);
  
  // Modal tab listeners
  elements.modalTabs.forEach(tab => {
    tab.addEventListener("click", () => {
      const tabName = tab.getAttribute('data-tab');
      switchTab(tabName);
    });
  });
  
  // Close modals when clicking outside
  elements.editModal.addEventListener("click", (e) => {
    if (e.target === elements.editModal) closeEditModal();
  });
  
  elements.passwordModal.addEventListener("click", (e) => {
    if (e.target === elements.passwordModal) closePasswordModal();
  });
}

// Toast notification system
function showToast(message, type = "info") {
  const toast = document.createElement("div");
  toast.className = `toast ${type}`;
  
  let icon = "info-circle";
  if (type === "success") icon = "check-circle";
  if (type === "error") icon = "exclamation-circle";
  if (type === "warning") icon = "exclamation-triangle";
  
  toast.innerHTML = `
    <i class="fas fa-${icon} toast-icon"></i>
    <div class="toast-message">${message}</div>
    <button class="toast-close">&times;</button>
  `;
  
  elements.toastContainer.appendChild(toast);
  
  // Add event listener to close button
  toast.querySelector(".toast-close").addEventListener("click", () => {
    toast.style.animation = "slideIn 0.3s ease reverse";
    setTimeout(() => toast.remove(), 300);
  });
  
  // Auto remove after 5 seconds
  setTimeout(() => {
    if (toast.parentNode) {
      toast.style.animation = "slideIn 0.3s ease reverse";
      setTimeout(() => toast.remove(), 300);
    }
  }, 5000);
}

// Dark mode functionality
function toggleDarkMode() {
  darkMode = !darkMode;
  setDarkMode(darkMode);
  localStorage.setItem('darkMode', darkMode);
}

function setDarkMode(enabled) {
  if (enabled) {
    document.body.classList.add("dark");
    elements.darkModeToggle.innerHTML = '<i class="fas fa-sun"></i>';
  } else {
    document.body.classList.remove("dark");
    elements.darkModeToggle.innerHTML = '<i class="fas fa-moon"></i>';
  }
}

// View mode functionality
function setViewMode(mode) {
  viewMode = mode;
  localStorage.setItem('viewMode', mode);
  
  if (mode === 'table') {
    elements.tableViewBtn.classList.add('active');
    elements.cardViewBtn.classList.remove('active');
    elements.accountsTable.style.display = 'table';
    elements.accountsCards.style.display = 'none';
  } else {
    elements.tableViewBtn.classList.remove('active');
    elements.cardViewBtn.classList.add('active');
    elements.accountsTable.style.display = 'none';
    elements.accountsCards.style.display = 'grid';
    renderCardsView();
  }
}

// Dashboard functionality
function toggleDashboard() {
  if (elements.dashboardSection.style.display === 'none') {
    elements.dashboardSection.style.display = 'grid';
    elements.settingsSection.style.display = 'none';
    updateDashboard();
  } else {
    elements.dashboardSection.style.display = 'none';
  }
}

function updateDashboard() {
  // Update stats
  const activeCount = accounts.filter(acc => getStatus(new Date(acc.endDate)) === 'status-active').length;
  const endingCount = accounts.filter(acc => getStatus(new Date(acc.endDate)) === 'status-ending').length;
  const endedCount = accounts.filter(acc => getStatus(new Date(acc.endDate)) === 'status-ended').length;
  
  document.getElementById('activeCount').textContent = activeCount;
  document.getElementById('endingCount').textContent = endingCount;
  document.getElementById('endedCount').textContent = endedCount;
  document.getElementById('totalCount').textContent = accounts.length;
  
  // Calculate average duration
  const avgDuration = accounts.length > 0 
    ? Math.round(accounts.reduce((sum, acc) => sum + acc.duration, 0) / accounts.length)
    : 0;
  document.getElementById('avgDuration').textContent = `${avgDuration}d`;
  
  // Calculate days saved (estimated money saved)
  // Assuming average subscription cost of $10/month
  const daysSaved = accounts.reduce((sum, acc) => {
    const endDate = new Date(acc.endDate);
    if (endDate > new Date()) {
      const daysRemaining = Math.ceil((endDate - new Date()) / (1000 * 60 * 60 * 24));
      return sum + daysRemaining;
    }
    return sum;
  }, 0);
  
  document.getElementById('daysSaved').textContent = daysSaved;
  
  // Update charts
  updateStatusChart(activeCount, endingCount, endedCount);
  updateTimelineChart();
}

function updateStatusChart(active, ending, ended) {
  const ctx = document.getElementById('statusChart').getContext('2d');
  
  // Destroy previous chart if it exists
  if (statusChart) {
    statusChart.destroy();
  }
  
  statusChart = new Chart(ctx, {
    type: 'doughnut',
    data: {
      labels: ['Active', 'Ending Soon', 'Expired'],
      datasets: [{
        data: [active, ending, ended],
        backgroundColor: [
          'rgba(52, 168, 83, 0.7)',
          'rgba(251, 188, 5, 0.7)',
          'rgba(234, 67, 53, 0.7)'
        ],
        borderColor: [
          'rgba(52, 168, 83, 1)',
          'rgba(251, 188, 5, 1)',
          'rgba(234, 67, 53, 1)'
        ],
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          position: 'bottom'
        }
      }
    }
  });
}

function updateTimelineChart() {
  // Group accounts by expiration date
  const next7Days = Array(7).fill(0).map((_, i) => {
    const date = new Date();
    date.setDate(date.getDate() + i);
    return date.toDateString();
  });
  
  const expirationsByDay = next7Days.map(day => {
    return accounts.filter(acc => {
      const expDate = new Date(acc.endDate);
      return expDate.toDateString() === day && expDate >= new Date();
    }).length;
  });
  
  const ctx = document.getElementById('timelineChart').getContext('2d');
  
  // Destroy previous chart if it exists
  if (timelineChart) {
    timelineChart.destroy();
  }
  
  timelineChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: next7Days.map(day => {
        const date = new Date(day);
        return `${date.getMonth()+1}/${date.getDate()}`;
      }),
      datasets: [{
        label: 'Trials Expiring',
        data: expirationsByDay,
        backgroundColor: 'rgba(66, 133, 244, 0.7)',
        borderColor: 'rgba(66, 133, 244, 1)',
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        y: {
          beginAtZero: true,
          ticks: {
            stepSize: 1
          }
        }
      }
    }
  });
}

// Settings functionality
function toggleSettings() {
  if (elements.settingsSection.style.display === 'none') {
    elements.settingsSection.style.display = 'block';
    elements.dashboardSection.style.display = 'none';
  } else {
    elements.settingsSection.style.display = 'none';
  }
}

function applySettings() {
  elements.browserNotifications.checked = settings.browserNotifications;
  elements.notificationTime.value = settings.notificationTime;
  elements.dataEncryption.checked = settings.dataEncryption;
  elements.autoBackup.checked = settings.autoBackup;
  elements.languageSelect.value = settings.language;
  
  if (settings.dataEncryption) {
    elements.encryptionPasswordItem.style.display = 'flex';
  }
}

function updateSettings() {
  settings.browserNotifications = elements.browserNotifications.checked;
  settings.notificationTime = parseInt(elements.notificationTime.value);
  settings.autoBackup = elements.autoBackup.checked;
  settings.language = elements.languageSelect.value;
  
  localStorage.setItem('browserNotifications', settings.browserNotifications);
  localStorage.setItem('notificationTime', settings.notificationTime);
  localStorage.setItem('autoBackup', settings.autoBackup);
  localStorage.setItem('language', settings.language);
  
  showToast("Settings saved", "success");
}

function toggleDataEncryption() {
  const enabled = elements.dataEncryption.checked;
  
  if (enabled) {
    if (!settings.encryptionPassword) {
      openPasswordModal();
    } else {
      elements.encryptionPasswordItem.style.display = 'flex';
      settings.dataEncryption = true;
      localStorage.setItem('dataEncryption', 'true');
      showToast("Data encryption enabled", "success");
    }
  } else {
    elements.encryptionPasswordItem.style.display = 'none';
    settings.dataEncryption = false;
    localStorage.setItem('dataEncryption', 'false');
    showToast("Data encryption disabled", "info");
  }
}

function openPasswordModal() {
  elements.passwordModal.style.display = 'flex';
}

function closePasswordModal() {
  elements.passwordModal.style.display = 'none';
  elements.passwordInput.value = '';
  elements.confirmPasswordInput.value = '';
  
  // If enabling encryption but no password was set, toggle back off
  if (elements.dataEncryption.checked && !settings.encryptionPassword) {
    elements.dataEncryption.checked = false;
  }
}

function savePassword() {
  const password = elements.passwordInput.value;
  const confirmPassword = elements.confirmPasswordInput.value;
  
  if (!password) {
    showToast("Please enter a password", "error");
    return;
  }
  
  if (password !== confirmPassword) {
    showToast("Passwords do not match", "error");
    return;
  }
  
  settings.encryptionPassword = password;
  localStorage.setItem('encryptionPassword', password);
  
  if (!elements.dataEncryption.checked) {
    elements.dataEncryption.checked = true;
  }
  
  settings.dataEncryption = true;
  localStorage.setItem('dataEncryption', 'true');
  
  elements.encryptionPasswordItem.style.display = 'flex';
  closePasswordModal();
  
  showToast("Encryption password set", "success");
}

function connectGoogleDrive() {
  showToast("Google Drive integration coming soon", "info");
}

// Check for notifications
function checkNotifications() {
  if (!settings.browserNotifications) return;
  
  accounts.forEach(acc => {
    const endDate = new Date(acc.endDate);
    const timeDiff = endDate - new Date();
    const hoursDiff = timeDiff / (1000 * 60 * 60);
    
    // Check if we should send a notification (within the notification time window)
    if (hoursDiff > 0 && hoursDiff <= settings.notificationTime && !acc.notified) {
      sendNotification(acc);
      acc.notified = true;
      saveData();
    }
  });
}

function sendNotification(account) {
  if ('Notification' in window && Notification.permission === 'granted') {
    const timeLeft = getTimeLeft(new Date(account.endDate));
    new Notification('Trial Expiring Soon', {
      body: `${account.email} trial expires in ${timeLeft}`,
      icon: 'https://example.com/icon.png' // Replace with your icon
    });
  }
}

// Account management functions
function addAccount() {
  const email = elements.emailInput.value.trim();
  const startDate = elements.startDateInput.value;
  const duration = parseInt(elements.durationInput.value);
  const tags = elements.tagsInput.value.split(',').map(tag => tag.trim()).filter(tag => tag);
  
  if (!email || !startDate || !duration) {
    showToast("Please fill all required fields", "error");
    return;
  }
  
  if (!isValidEmail(email)) {
    showToast("Please enter a valid email address", "error");
    return;
  }
  
  const endDate = new Date(startDate);
  endDate.setDate(endDate.getDate() + duration);
  
  accounts.push({ 
    email, 
    startDate, 
    duration, 
    endDate: endDate.toISOString(),
    tags,
    notified: false
  });
  
  saveData();
  renderAccounts();
  updateDashboard();
  
  // Reset form
  elements.emailInput.value = "";
  const now = new Date();
  const localDateTime = new Date(now.getTime() - now.getTimezoneOffset() * 60000).toISOString().slice(0, 16);
  elements.startDateInput.value = localDateTime;
  elements.durationInput.value = 30;
  elements.tagsInput.value = "";
  
  showToast("Account added successfully", "success");
}

function isValidEmail(email) {
  const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  return re.test(email);
}

function renderAccounts() {
  if (accounts.length === 0) {
    elements.emptyState.style.display = "block";
    elements.accountsTable.style.display = "none";
    elements.accountsCards.style.display = "none";
    return;
  }
  
  elements.emptyState.style.display = "none";
  
  if (viewMode === 'table') {
    elements.accountsTable.style.display = "table";
    elements.accountsCards.style.display = "none";
    renderTableView();
  } else {
    elements.accountsTable.style.display = "none";
    elements.accountsCards.style.display = "grid";
    renderCardsView();
  }
  
  updateTagFilter();
}

function renderTableView() {
  // Sort accounts by end date
  accounts.sort((a, b) => new Date(a.endDate) - new Date(b.endDate));
  
  let accountsHTML = "";
  
  accounts.forEach((acc, index) => {
    const startDate = new Date(acc.startDate);
    const endDate = new Date(acc.endDate);
    
    const totalDuration = endDate - startDate;
    const elapsed = new Date() - startDate;
    const progressPercent = Math.min(Math.max((elapsed / totalDuration) * 100, 0), 100);
    
    const statusClass = getStatus(endDate);
    let progressClass = 'progress-active';
    if (statusClass === 'status-ending') progressClass = 'progress-ending';
    if (statusClass === 'status-ended') progressClass = 'progress-ended';
    
    accountsHTML += `
      <tr data-email="${acc.email.toLowerCase()}" data-status="${statusClass.replace('status-', '')}" data-tags="${acc.tags.join(',')}">
        <td>${acc.email}</td>
        <td>${formatDateTimeAMPM(startDate)}</td>
        <td>${formatDateTimeAMPM(endDate)}</td>
        <td><span class="status-indicator ${statusClass}">${statusClass.replace("status-", "")}</span></td>
        <td class="time-left">${getTimeLeft(endDate)}</td>
        <td>
          <div class="progress-container">
            <div class="progress-bar ${progressClass}" style="width: ${progressPercent}%"></div>
          </div>
        </td>
        <td>
          <div class="action-buttons">
            <button class="icon-btn edit-account" data-index="${index}">
              <i class="fas fa-edit"></i>
            </button>
            <button class="icon-btn remove-account" data-index="${index}">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        </td>
      </tr>
    `;
  });
  
  elements.accountsTableBody.innerHTML = accountsHTML;
  
  // Add event listeners to action buttons
  document.querySelectorAll(".edit-account").forEach(btn => {
    btn.addEventListener("click", () => {
      const index = btn.getAttribute("data-index");
      openEditModal(index);
    });
  });
  
  document.querySelectorAll(".remove-account").forEach(btn => {
    btn.addEventListener("click", () => {
      const index = btn.getAttribute("data-index");
      removeAccount(index);
    });
  });
  
  // Apply filters
  filterAccounts();
}

function renderCardsView() {
  // Sort accounts by end date
  accounts.sort((a, b) => new Date(a.endDate) - new Date(b.endDate));
  
  let accountsHTML = "";
  
  accounts.forEach((acc, index) => {
    const startDate = new Date(acc.startDate);
    const endDate = new Date(acc.endDate);
    
    const totalDuration = endDate - startDate;
    const elapsed = new Date() - startDate;
    const progressPercent = Math.min(Math.max((elapsed / totalDuration) * 100, 0), 100);
    
    const statusClass = getStatus(endDate);
    let progressClass = 'progress-active';
    if (statusClass === 'status-ending') progressClass = 'progress-ending';
    if (statusClass === 'status-ended') progressClass = 'progress-ended';
    
    accountsHTML += `
      <div class="account-card" data-email="${acc.email.toLowerCase()}" data-status="${statusClass.replace('status-', '')}" data-tags="${acc.tags.join(',')}">
        <div class="account-card-header">
          <div>
            <div class="account-email">${acc.email}</div>
            <span class="status-indicator ${statusClass}">${statusClass.replace("status-", "")}</span>
          </div>
          <div class="action-buttons">
            <button class="icon-btn edit-account" data-index="${index}">
              <i class="fas fa-edit"></i>
            </button>
            <button class="icon-btn remove-account" data-index="${index}">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        </div>
        ${acc.tags.length > 0 ? `
        <div class="account-tags">
          ${acc.tags.map(tag => `<span class="account-tag">${tag}</span>`).join('')}
        </div>
        ` : ''}
        <div class="account-dates">
          <div class="account-date">
            <span class="account-date-label">Start:</span>
            <span>${formatDateTimeAMPM(startDate)}</span>
          </div>
          <div class="account-date">
            <span class="account-date-label">End:</span>
            <span>${formatDateTimeAMPM(endDate)}</span>
          </div>
          <div class="account-date">
            <span class="account-date-label">Time Left:</span>
            <span class="time-left">${getTimeLeft(endDate)}</span>
          </div>
        </div>
        <div class="account-progress">
          <div class="progress-container">
            <div class="progress-bar ${progressClass}" style="width: ${progressPercent}%"></div>
          </div>
        </div>
      </div>
    `;
  });
  
  elements.accountsCards.innerHTML = accountsHTML;
  
  // Add event listeners to action buttons
  document.querySelectorAll(".edit-account").forEach(btn => {
    btn.addEventListener("click", () => {
      const index = btn.getAttribute("data-index");
      openEditModal(index);
    });
  });
  
  document.querySelectorAll(".remove-account").forEach(btn => {
    btn.addEventListener("click", () => {
      const index = btn.getAttribute("data-index");
      removeAccount(index);
    });
  });
  
  // Apply filters
  filterAccounts();
}

function updateTimers() {
  document.querySelectorAll(".time-left").forEach(el => {
    const card = el.closest(".account-card");
    const row = el.closest("tr");
    const element = card || row;
    const email = element.getAttribute("data-email");
    const account = accounts.find(acc => acc.email.toLowerCase() === email);
    
    if (account) {
      const endDate = new Date(account.endDate);
      el.textContent = getTimeLeft(endDate);
      
      // Update progress bar
      const startDate = new Date(account.startDate);
      const totalDuration = endDate - startDate;
      const elapsed = new Date() - startDate;
      const progressPercent = Math.min(Math.max((elapsed / totalDuration) * 100, 0), 100);
      
      const progressBar = element.querySelector(".progress-bar");
      if (progressBar) {
        progressBar.style.width = `${progressPercent}%`;
      }
      
      // Update status if needed
      const statusClass = getStatus(endDate);
      let progressClass = 'progress-active';
      if (statusClass === 'status-ending') progressClass = 'progress-ending';
      if (statusClass === 'status-ended') progressClass = 'progress-ended';
      
      if (progressBar) {
        progressBar.className = `progress-bar ${progressClass}`;
      }
      
      const statusIndicator = element.querySelector(".status-indicator");
      if (statusIndicator) {
        statusIndicator.className = `status-indicator ${statusClass}`;
        statusIndicator.textContent = statusClass.replace("status-", "");
      }
      
      // Update data attributes for filtering
      element.setAttribute("data-status", statusClass.replace('status-', ''));
    }
  });
}

function filterAccounts() {
  const searchTerm = elements.searchInput.value.toLowerCase();
  const statusFilter = elements.statusFilter.value;
  const tagFilter = elements.tagFilter.value;
  
  // Filter table view
  document.querySelectorAll("#accountsTableBody tr").forEach(row => {
    const email = row.getAttribute("data-email");
    const status = row.getAttribute("data-status");
    const tags = row.getAttribute("data-tags");
    
    const matchesSearch = email.includes(searchTerm);
    const matchesStatus = statusFilter === 'all' || status === statusFilter;
    const matchesTag = tagFilter === 'all' || tags.includes(tagFilter);
    
    if (matchesSearch && matchesStatus && matchesTag) {
      row.style.display = "table-row";
    } else {
      row.style.display = "none";
    }
  });
  
  // Filter cards view
  document.querySelectorAll(".account-card").forEach(card => {
    const email = card.getAttribute("data-email");
    const status = card.getAttribute("data-status");
    const tags = card.getAttribute("data-tags");
    
    const matchesSearch = email.includes(searchTerm);
    const matchesStatus = statusFilter === 'all' || status === statusFilter;
    const matchesTag = tagFilter === 'all' || tags.includes(tagFilter);
    
    if (matchesSearch && matchesStatus && matchesTag) {
      card.style.display = "block";
    } else {
      card.style.display = "none";
    }
  });
}

function updateTagFilter() {
  // Get all unique tags
  const allTags = new Set();
  accounts.forEach(acc => {
    acc.tags.forEach(tag => allTags.add(tag));
  });
  
  // Update tag filter dropdown
  let options = '<option value="all">All Tags</option>';
  allTags.forEach(tag => {
    options += `<option value="${tag}">${tag}</option>`;
  });
  
  elements.tagFilter.innerHTML = options;
}

function getTimeLeft(endDate) {
  const now = new Date();
  const diff = endDate - now;
  
  if (diff <= 0) return "Expired";
  
  const days = Math.floor(diff / (1000 * 60 * 60 * 24));
  const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
  const minutes = Math.floor((diff / (1000 * 60)) % 60);
  const seconds = Math.floor((diff / 1000) % 60);
  
  return `${days}d ${hours}h ${minutes}m ${seconds}s`;
}

function getStatus(endDate) {
  const now = new Date();
  if (endDate < now) return "status-ended";
  
  const diffDays = (endDate - now) / (1000 * 60 * 60 * 24);
  if (diffDays <= 1) return "status-ending";
  
  return "status-active";
}

// Format date with AM/PM
function formatDateTimeAMPM(date) {
  const options = { 
    year: 'numeric', 
    month: 'short', 
    day: 'numeric',
    hour: 'numeric',
    minute: '2-digit',
    hour12: true
  };
  return date.toLocaleString(undefined, options);
}

function openEditModal(index) {
  editingIndex = index;
  const acc = accounts[index];
  
  elements.editEmail.value = acc.email;
  elements.editStartDate.value = acc.startDate;
  elements.editDuration.value = acc.duration;
  
  // Populate tags
  elements.editTagsList.innerHTML = '';
  acc.tags.forEach(tag => {
    addTagToUI(tag);
  });
  
  // Reset to details tab
  switchTab('details');
  
  elements.editModal.style.display = "flex";
}

function switchTab(tabName) {
  // Deactivate all tabs
  elements.modalTabs.forEach(tab => tab.classList.remove('active'));
  elements.tabContents.forEach(content => content.classList.remove('active'));
  
  // Activate selected tab
  document.querySelector(`.modal-tab[data-tab="${tabName}"]`).classList.add('active');
  document.getElementById(`${tabName}Tab`).classList.add('active');
}

function addTagToEdit() {
  const tag = elements.editTagsInput.value.trim();
  if (!tag) return;
  
  addTagToUI(tag);
  elements.editTagsInput.value = '';
}

function addTagToUI(tag) {
  const tagElement = document.createElement('div');
  tagElement.className = 'tag';
  tagElement.innerHTML = `
    ${tag}
    <button class="tag-remove" data-tag="${tag}">&times;</button>
  `;
  
  elements.editTagsList.appendChild(tagElement);
  
  // Add event listener to remove button
  tagElement.querySelector('.tag-remove').addEventListener('click', (e) => {
    e.preventDefault();
    tagElement.remove();
  });
}

function closeEditModal() {
  elements.editModal.style.display = "none";
  editingIndex = null;
}

function saveEdit() {
  if (editingIndex === null) return;
  
  accounts[editingIndex].email = elements.editEmail.value;
  accounts[editingIndex].startDate = elements.editStartDate.value;
  accounts[editingIndex].duration = parseInt(elements.editDuration.value);
  
  // Get tags from UI
  const tags = [];
  elements.editTagsList.querySelectorAll('.tag').forEach(tagEl => {
    const tagText = tagEl.textContent.replace('Ã—', '').trim();
    tags.push(tagText);
  });
  accounts[editingIndex].tags = tags;
  
  const endDate = new Date(elements.editStartDate.value);
  endDate.setDate(endDate.getDate() + accounts[editingIndex].duration);
  accounts[editingIndex].endDate = endDate.toISOString();
  accounts[editingIndex].notified = false; // Reset notification
  
  saveData();
  renderAccounts();
  updateDashboard();
  closeEditModal();
  
  showToast("Account updated successfully", "success");
}

function removeAccount(index) {
  if (confirm("Are you sure you want to remove this account?")) {
    accounts.splice(index, 1);
    saveData();
    renderAccounts();
    updateDashboard();
    showToast("Account removed", "info");
  }
}

function exportAccounts() {
  const dataStr = JSON.stringify(accounts, null, 2);
  const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
  
  const exportFileDefaultName = 'premium_trial_accounts.json';
  
  const linkElement = document.createElement('a');
  linkElement.setAttribute('href', dataUri);
  linkElement.setAttribute('download', exportFileDefaultName);
  linkElement.click();
  
  showToast("Accounts exported successfully", "success");
}

function exportAccountsCsv() {
  let csvContent = "Email,Start Date,End Date,Duration,Status,Tags\n";
  
  accounts.forEach(acc => {
    const startDate = new Date(acc.startDate);
    const endDate = new Date(acc.endDate);
    const status = getStatus(endDate).replace('status-', '');
    const tags = acc.tags.join(';');
    
    csvContent += `"${acc.email}","${formatDateTimeAMPM(startDate)}","${formatDateTimeAMPM(endDate)}",${acc.duration},${status},"${tags}"\n`;
  });
  
  const dataUri = 'data:text/csv;charset=utf-8,' + encodeURIComponent(csvContent);
  const exportFileDefaultName = 'premium_trial_accounts.csv';
  
  const linkElement = document.createElement('a');
  linkElement.setAttribute('href', dataUri);
  linkElement.setAttribute('download', exportFileDefaultName);
  linkElement.click();
  
  showToast("Accounts exported as CSV", "success");
}

function importAccounts(e) {
  const file = e.target.files[0];
  if (!file) return;
  
  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      let imported;
      if (file.name.endsWith('.csv')) {
        imported = parseCsv(e.target.result);
      } else {
        imported = JSON.parse(e.target.result);
      }
      
      if (Array.isArray(imported)) {
        // Add imported accounts to existing ones
        accounts = [...accounts, ...imported];
        saveData();
        renderAccounts();
        updateDashboard();
        showToast("Accounts imported successfully", "success");
      } else {
        showToast("Invalid file format", "error");
      }
    } catch (err) {
      showToast("Error reading file", "error");
    }
  };
  reader.readAsText(file);
  e.target.value = "";
}

function parseCsv(csvData) {
  const lines = csvData.split('\n');
  const accounts = [];
  
  // Skip header line
  for (let i = 1; i < lines.length; i++) {
    const line = lines[i].trim();
    if (!line) continue;
    
    // Simple CSV parsing (this may need improvement for more complex cases)
    const values = line.split(',').map(value => {
      // Remove quotes if present
      return value.replace(/^"(.*)"$/, '$1').trim();
    });
    
    if (values.length >= 5) {
      const email = values[0];
      const startDate = new Date(values[1]);
      const endDate = new Date(values[2]);
      const duration = parseInt(values[3]);
      const tags = values[5] ? values[5].split(';') : [];
      
      accounts.push({
        email,
        startDate: startDate.toISOString(),
        duration,
        endDate: endDate.toISOString(),
        tags,
        notified: false
      });
    }
  }
  
  return accounts;
}

function saveData() {
  let dataToSave = JSON.stringify(accounts);
  
  // Encrypt data if encryption is enabled
  if (settings.dataEncryption && settings.encryptionPassword) {
    // Simple encryption (in a real app, use a proper encryption library)
    dataToSave = btoa(settings.encryptionPassword + '|' + dataToSave);
  }
  
  localStorage.setItem("accounts", dataToSave);
}

function loadData() {
  let data = localStorage.getItem("accounts");
  if (data) {
    try {
      // Check if data is encrypted
      if (settings.dataEncryption && settings.encryptionPassword) {
        try {
          const decrypted = atob(data);
          const parts = decrypted.split('|');
          if (parts[0] === settings.encryptionPassword) {
            data = parts.slice(1).join('|');
          } else {
            showToast("Incorrect encryption password", "error");
            return;
          }
        } catch (e) {
          showToast("Error decrypting data", "error");
          return;
        }
      }
      
      accounts = JSON.parse(data);
    } catch (e) {
      accounts = [];
    }
  }
}

// Initialize the app when DOM is loaded
document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>