<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ðŸŽ¥ Premium Trial Tracker</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root {
  --primary: #FF3B30;
  --primary-dark: #D70015;
  --primary-light: #FF6257;
  --secondary: #007AFF;
  --secondary-dark: #0056CC;
  --success: #34C759;
  --warning: #FF9500;
  --danger: #FF3B30;
  --info: #5AC8FA;
  
  --bg-light: #F2F2F7;
  --bg-card-light: #FFFFFF;
  --text-primary-light: #1C1C1E;
  --text-secondary-light: #636366;
  --border-light: #C5C6C7;
  
  --bg-dark: #1C1C1E;
  --bg-card-dark: #2C2C2E;
  --text-primary-dark: #E5E5EA;
  --text-secondary-dark: #98989D;
  --border-dark: #404044;
  
  --shadow-sm: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.08);
  --shadow-md: 0 4px 6px rgba(0,0,0,0.1), 0 1px 3px rgba(0,0,0,0.08);
  --shadow-lg: 0 10px 25px rgba(0,0,0,0.15), 0 5px 10px rgba(0,0,0,0.1);
  --radius: 16px;
  --radius-sm: 10px;
  --transition: all 0.3s ease;
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: 'Inter', sans-serif;
  background-color: var(--bg-light);
  color: var(--text-primary-light);
  max-width: 1400px;
  margin: 0 auto;
  padding: 20px;
  transition: var(--transition);
  line-height: 1.6;
}

body.dark {
  background-color: var(--bg-dark);
  color: var(--text-primary-dark);
}

/* Header Styles */
.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 30px;
  padding-bottom: 15px;
  border-bottom: 1px solid var(--border-light);
}

body.dark .header {
  border-bottom-color: var(--border-dark);
}

.logo {
  display: flex;
  align-items: center;
  gap: 12px;
}

.logo-icon {
  font-size: 32px;
  color: var(--primary);
}

.logo-text {
  font-size: 26px;
  font-weight: 700;
  background: linear-gradient(45deg, var(--primary), var(--secondary));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.header-actions {
  display: flex;
  gap: 12px;
  align-items: center;
}

/* Control Panel */
.control-panel {
  background: var(--bg-card-light);
  padding: 24px;
  border-radius: var(--radius);
  box-shadow: var(--shadow-md);
  margin-bottom: 24px;
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  transition: var(--transition);
}

body.dark .control-panel {
  background: var(--bg-card-dark);
  box-shadow: 0 4px 6px rgba(0,0,0,0.25);
}

.form-group {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

label {
  font-weight: 500;
  font-size: 14px;
  color: var(--text-secondary-light);
  display: flex;
  align-items: center;
  gap: 8px;
}

body.dark label {
  color: var(--text-secondary-dark);
}

.input-icon {
  color: var(--primary);
}

input, select, textarea {
  padding: 14px 16px;
  border: 1px solid var(--border-light);
  border-radius: var(--radius-sm);
  font-size: 15px;
  transition: var(--transition);
  background: var(--bg-card-light);
  color: var(--text-primary-light);
}

body.dark input, 
body.dark select,
body.dark textarea {
  background: var(--bg-dark);
  color: var(--text-primary-dark);
  border-color: var(--border-dark);
}

input:focus, select:focus, textarea:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(255, 59, 48, 0.15);
}

.btn {
  padding: 14px 20px;
  border: none;
  border-radius: var(--radius-sm);
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  font-size: 15px;
}

.btn-primary {
  background: var(--primary);
  color: white;
  box-shadow: 0 4px 12px rgba(255, 59, 48, 0.25);
}

.btn-primary:hover {
  background: var(--primary-dark);
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(255, 59, 48, 0.35);
}

.btn-secondary {
  background: var(--secondary);
  color: white;
  box-shadow: 0 4px 12px rgba(0, 122, 255, 0.25);
}

.btn-secondary:hover {
  background: var(--secondary-dark);
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(0, 122, 255, 0.35);
}

.btn-success {
  background: var(--success);
  color: white;
  box-shadow: 0 4px 12px rgba(52, 199, 89, 0.25);
}

.btn-success:hover {
  background: #2CA44D;
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(52, 199, 89, 0.35);
}

.btn-outline {
  background: transparent;
  border: 1px solid var(--border-light);
  color: var(--text-secondary-light);
}

body.dark .btn-outline {
  border-color: var(--border-dark);
  color: var(--text-secondary-dark);
}

.btn-outline:hover {
  background: rgba(0,0,0,0.05);
  border-color: var(--primary);
  color: var(--primary);
}

body.dark .btn-outline:hover {
  background: rgba(255,255,255,0.05);
}

.btn-sm {
  padding: 10px 16px;
  font-size: 14px;
}

/* Dashboard Stats */
.dashboard-stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
  margin-bottom: 24px;
}

.stat-card {
  background: var(--bg-card-light);
  padding: 20px;
  border-radius: var(--radius);
  box-shadow: var(--shadow-md);
  text-align: center;
  transition: var(--transition);
}

body.dark .stat-card {
  background: var(--bg-card-dark);
}

.stat-icon {
  font-size: 32px;
  margin-bottom: 12px;
  display: flex;
  justify-content: center;
}

.stat-active .stat-icon {
  color: var(--success);
}

.stat-ending .stat-icon {
  color: var(--warning);
}

.stat-ended .stat-icon {
  color: var(--danger);
}

.stat-value {
  font-size: 32px;
  font-weight: 700;
  margin-bottom: 8px;
}

.stat-label {
  color: var(--text-secondary-light);
  font-size: 14px;
}

body.dark .stat-label {
  color: var(--text-secondary-dark);
}

/* Action Bar */
.action-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 24px;
  flex-wrap: wrap;
  gap: 16px;
}

.search-container {
  position: relative;
  flex: 1;
  max-width: 400px;
}

.search-container i {
  position: absolute;
  left: 16px;
  top: 50%;
  transform: translateY(-50%);
  color: var(--text-secondary-light);
}

body.dark .search-container i {
  color: var(--text-secondary-dark);
}

.search-input {
  padding-left: 44px;
  width: 100%;
}

.filter-container {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
}

.filter-select {
  min-width: 120px;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23636366' viewBox='0 0 24 24'%3E%3Cpath d='M7 10l5 5 5-5z'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 12px center;
  background-size: 16px;
  padding-right: 40px;
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
}

.export-import {
  display: flex;
  gap: 12px;
}

.view-toggle {
  display: flex;
  border: 1px solid var(--border-light);
  border-radius: var(--radius-sm);
  overflow: hidden;
}

body.dark .view-toggle {
  border-color: var(--border-dark);
}

.view-btn {
  padding: 10px 12px;
  background: var(--bg-card-light);
  border: none;
  color: var(--text-secondary-light);
  cursor: pointer;
  transition: var(--transition);
}

body.dark .view-btn {
  background: var(--bg-card-dark);
  color: var(--text-secondary-dark);
}

.view-btn.active {
  background: var(--primary);
  color: white;
}

/* Accounts Table */
.accounts-table {
  width: 100%;
  border-collapse: collapse;
  background: var(--bg-card-light);
  box-shadow: var(--shadow-md);
  border-radius: var(--radius);
  overflow: hidden;
  margin-bottom: 40px;
  transition: var(--transition);
}

body.dark .accounts-table {
  background: var(--bg-card-dark);
}

.accounts-table th,
.accounts-table td {
  padding: 16px;
  text-align: left;
  border-bottom: 1px solid var(--border-light);
  transition: var(--transition);
}

body.dark .accounts-table th,
body.dark .accounts-table td {
  border-color: var(--border-dark);
}

.accounts-table th {
  background: var(--bg-light);
  font-weight: 600;
  color: var(--text-primary-light);
  position: sticky;
  top: 0;
}

body.dark .accounts-table th {
  background: var(--bg-dark);
  color: var(--text-primary-dark);
}

.accounts-table tr:last-child td {
  border-bottom: none;
}

.accounts-table tr:hover {
  background: rgba(0,0,0,0.02);
  transition: var(--transition);
}

body.dark .accounts-table tr:hover {
  background: rgba(255,255,255,0.02);
}

/* Status Indicator */
.status-indicator {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
}

.status-active {
  background: rgba(52, 199, 89, 0.15);
  color: var(--success);
}

.status-ending {
  background: rgba(255, 149, 0, 0.15);
  color: var(--warning);
}

.status-ended {
  background: rgba(255, 59, 48, 0.15);
  color: var(--danger);
}

.status-indicator::before {
  content: "";
  width: 8px;
  height: 8px;
  border-radius: 50%;
  display: inline-block;
}

.status-active::before {
  background: var(--success);
}

.status-ending::before {
  background: var(--warning);
}

.status-ended::before {
  background: var(--danger);
}

/* Time Left */
.time-left {
  font-family: 'SF Mono', 'Roboto Mono', monospace;
  font-weight: 600;
  font-size: 14px;
  color: var(--text-primary-light);
}

body.dark .time-left {
  color: var(--text-primary-dark);
}

/* Action Buttons */
.action-buttons {
  display: flex;
  gap: 8px;
}

.icon-btn {
  background: transparent;
  border: none;
  width: 36px;
  height: 36px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: var(--transition);
  color: var(--text-secondary-light);
}

body.dark .icon-btn {
  color: var(--text-secondary-dark);
}

.icon-btn:hover {
  background: rgba(0,0,0,0.05);
  color: var(--primary);
}

body.dark .icon-btn:hover {
  background: rgba(255,255,255,0.05);
}

/* Progress Bar */
.progress-container {
  width: 100%;
  background: var(--border-light);
  border-radius: 100px;
  height: 6px;
  margin-top: 6px;
  overflow: hidden;
  position: relative;
}

body.dark .progress-container {
  background: var(--border-dark);
}

.progress-bar {
  height: 100%;
  border-radius: 100px;
  width: 0%;
  transition: width 1s ease;
  position: relative;
}

.progress-active {
  background: linear-gradient(90deg, var(--success), #2CA44D);
}

.progress-ending {
  background: linear-gradient(90deg, var(--warning), #E68600);
}

.progress-ended {
  background: linear-gradient(90deg, var(--danger), #D70015);
}

/* Empty State */
.empty-state {
  text-align: center;
  padding: 60px 20px;
  color: var(--text-secondary-light);
  grid-column: 1 / -1;
}

body.dark .empty-state {
  color: var(--text-secondary-dark);
}

.empty-icon {
  font-size: 64px;
  margin-bottom: 16px;
  opacity: 0.5;
}

.empty-title {
  font-size: 20px;
  font-weight: 600;
  margin-bottom: 8px;
}

.empty-desc {
  max-width: 500px;
  margin: 0 auto 24px;
}

/* Dark Mode Toggle */
.dark-mode-toggle {
  position: fixed;
  bottom: 24px;
  right: 24px;
  width: 56px;
  height: 56px;
  border-radius: 50%;
  background: var(--bg-card-light);
  color: var(--text-primary-light);
  border: 1px solid var(--border-light);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  box-shadow: var(--shadow-lg);
  z-index: 100;
  transition: var(--transition);
}

body.dark .dark-mode-toggle {
  background: var(--bg-card-dark);
  color: var(--text-primary-dark);
  border-color: var(--border-dark);
}

.dark-mode-toggle:hover {
  transform: rotate(15deg) scale(1.1);
}

/* Modal */
.modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.5);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 1000;
  padding: 20px;
  backdrop-filter: blur(4px);
}

.modal-content {
  background: var(--bg-card-light);
  padding: 24px;
  border-radius: var(--radius);
  width: 100%;
  max-width: 500px;
  box-shadow: var(--shadow-lg);
  transition: var(--transition);
  max-height: 90vh;
  overflow-y: auto;
}

body.dark .modal-content {
  background: var(--bg-card-dark);
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.modal-title {
  font-size: 20px;
  font-weight: 600;
}

.modal-close {
  background: transparent;
  border: none;
  font-size: 24px;
  cursor: pointer;
  color: var(--text-secondary-light);
  transition: var(--transition);
}

body.dark .modal-close {
  color: var(--text-secondary-dark);
}

.modal-close:hover {
  color: var(--primary);
}

.modal-body {
  display: flex;
  flex-direction: column;
  gap: 16px;
  margin-bottom: 24px;
}

.modal-footer {
  display: flex;
  justify-content: flex-end;
  gap: 12px;
}

/* Toast Notification */
.toast-container {
  position: fixed;
  top: 24px;
  right: 24px;
  z-index: 1100;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.toast {
  padding: 16px 20px;
  border-radius: var(--radius-sm);
  background: var(--bg-card-light);
  color: var(--text-primary-light);
  box-shadow: var(--shadow-lg);
  display: flex;
  align-items: center;
  gap: 12px;
  animation: slideIn 0.3s ease;
  max-width: 350px;
}

body.dark .toast {
  background: var(--bg-card-dark);
  color: var(--text-primary-dark);
}

.toast.success {
  border-left: 4px solid var(--success);
}

.toast.error {
  border-left: 4px solid var(--danger);
}

.toast.info {
  border-left: 4px solid var(--info);
}

.toast.warning {
  border-left: 4px solid var(--warning);
}

.toast-icon {
  font-size: 20px;
}

.toast.success .toast-icon {
  color: var(--success);
}

.toast.error .toast-icon {
  color: var(--danger);
}

.toast.info .toast-icon {
  color: var(--info);
}

.toast.warning .toast-icon {
  color: var(--warning);
}

.toast-message {
  flex: 1;
  font-size: 14px;
}

.toast-close {
  background: transparent;
  border: none;
  cursor: pointer;
  color: var(--text-secondary-light);
  font-size: 18px;
}

body.dark .toast-close {
  color: var(--text-secondary-dark);
}

@keyframes slideIn {
  from {
    transform: translateX(100%);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

/* Dashboard View */
.dashboard-view {
  display: none;
}

.dashboard-view.active {
  display: block;
}

.accounts-view.active {
  display: block;
}

.accounts-view {
  display: none;
}

/* Responsive Adjustments */
@media (max-width: 1200px) {
  .accounts-table {
    display: block;
    overflow-x: auto;
  }
}

@media (max-width: 768px) {
  .header {
    flex-direction: column;
    align-items: flex-start;
    gap: 16px;
  }
  
  .action-bar {
    flex-direction: column;
    align-items: stretch;
  }
  
  .search-container {
    max-width: 100%;
  }
  
  .control-panel {
    grid-template-columns: 1fr;
  }
  
  .export-import {
    flex-direction: column;
  }
  
  .accounts-table {
    font-size: 14px;
  }
  
  .accounts-table th,
  .accounts-table td {
    padding: 12px 8px;
  }
  
  .time-left {
    font-size: 12px;
  }
  
  .filter-container {
    flex-direction: column;
    width: 100%;
  }
  
  .filter-select {
    width: 100%;
  }
  
  .dashboard-stats {
    grid-template-columns: 1fr;
  }
}

@media (max-width: 480px) {
  body {
    padding: 16px;
  }
  
  .modal-content {
    padding: 20px 16px;
  }
  
  .modal-footer {
    flex-direction: column;
  }
  
  .btn {
    width: 100%;
  }
}
</style>
</head>
<body>

<div class="header">
  <div class="logo">
    <div class="logo-icon"><i class="fas fa-film"></i></div>
    <div class="logo-text">Premium Trial Tracker</div>
  </div>
  <div class="header-actions">
    <button id="dashboardBtn" class="btn btn-outline btn-sm"><i class="fas fa-chart-pie"></i> Dashboard</button>
    <div class="dark-mode-toggle" id="darkModeToggle">
      <i class="fas fa-moon"></i>
    </div>
  </div>
</div>

<div class="dashboard-view" id="dashboardView">
  <div class="dashboard-stats" id="dashboardStats">
    <div class="stat-card stat-active">
      <div class="stat-icon"><i class="fas fa-check-circle"></i></div>
      <div class="stat-value" id="activeCount">0</div>
      <div class="stat-label">Active Trials</div>
    </div>
    <div class="stat-card stat-ending">
      <div class="stat-icon"><i class="fas fa-exclamation-triangle"></i></div>
      <div class="stat-value" id="endingCount">0</div>
      <div class="stat-label">Ending Soon</div>
    </div>
    <div class="stat-card stat-ended">
      <div class="stat-icon"><i class="fas fa-times-circle"></i></div>
      <div class="stat-value" id="expiredCount">0</div>
      <div class="stat-label">Expired Trials</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon"><i class="fas fa-envelope"></i></div>
      <div class="stat-value" id="totalCount">0</div>
      <div class="stat-label">Total Accounts</div>
    </div>
  </div>
  
  <div class="action-bar">
    <h3>Ending Soon (Next 24 Hours)</h3>
  </div>
  
  <table class="accounts-table" id="dashboardTable">
    <thead>
      <tr>
        <th>Gmail</th>
        <th>End Date</th>
        <th>Time Remaining</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody id="dashboardTableBody">
      <!-- Ending soon accounts will be inserted here -->
    </tbody>
  </table>
  
  <div class="empty-state" id="dashboardEmptyState">
    <div class="empty-icon"><i class="fas fa-check-circle"></i></div>
    <h3 class="empty-title">No trials ending soon</h3>
    <p class="empty-desc">You don't have any trials expiring in the next 24 hours.</p>
  </div>
</div>

<div class="accounts-view active" id="accountsView">
  <div class="control-panel">
    <div class="form-group">
      <label for="email"><i class="fas fa-envelope input-icon"></i> Gmail Address</label>
      <input type="email" id="email" placeholder="example@gmail.com" required>
    </div>
    <div class="form-group">
      <label for="startDate"><i class="fas fa-calendar-alt input-icon"></i> Trial Start Date & Time</label>
      <input type="datetime-local" id="startDate" required>
    </div>
    <div class="form-group">
      <label for="duration"><i class="fas fa-clock input-icon"></i> Trial Duration (days)</label>
      <input type="number" id="duration" min="1" value="30" required>
    </div>
    <div class="form-group" style="justify-content: flex-end;">
      <button id="addAccount" class="btn btn-primary"><i class="fas fa-plus"></i> Add Account</button>
    </div>
  </div>

  <div class="action-bar">
    <div class="search-container">
      <i class="fas fa-search"></i>
      <input type="text" id="searchInput" class="search-input" placeholder="Search Gmail accounts...">
    </div>
    <div class="filter-container">
      <select id="statusFilter" class="filter-select">
        <option value="all">All Status</option>
        <option value="active">Active</option>
        <option value="ending">Ending Soon</option>
        <option value="ended">Expired</option>
      </select>
    </div>
    <div class="export-import">
      <button id="exportBtn" class="btn btn-outline"><i class="fas fa-file-export"></i> Export</button>
      <label for="importFile" class="btn btn-outline"><i class="fas fa-file-import"></i> Import</label>
      <input type="file" id="importFile" accept=".json" style="display: none;">
    </div>
  </div>

  <table class="accounts-table" id="accountsTable">
    <thead>
      <tr>
        <th>Gmail</th>
        <th>Start Date</th>
        <th>End Date</th>
        <th>Status</th>
        <th>Time Remaining</th>
        <th>Progress</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="accountsTableBody">
      <!-- Accounts will be inserted here -->
    </tbody>
  </table>

  <div class="empty-state" id="emptyState">
    <div class="empty-icon"><i class="fas fa-inbox"></i></div>
    <h3 class="empty-title">No accounts yet</h3>
    <p class="empty-desc">Add your first trial account to start tracking its expiration date and time remaining.</p>
    <button class="btn btn-primary" id="addFirstAccount"><i class="fas fa-plus"></i> Add Account</button>
  </div>
</div>

<div id="editModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3 class="modal-title">Edit Account</h3>
      <button class="modal-close">&times;</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label for="editEmail">Email Address</label>
        <input type="text" id="editEmail">
      </div>
      <div class="form-group">
        <label for="editStartDate">Start Date & Time</label>
        <input type="datetime-local" id="editStartDate">
      </div>
      <div class="form-group">
        <label for="editDuration">Duration (days)</label>
        <input type="number" id="editDuration" value="30">
      </div>
    </div>
    <div class="modal-footer">
      <button id="cancelEditBtn" class="btn btn-outline">Cancel</button>
      <button id="saveEditBtn" class="btn btn-primary">Save Changes</button>
    </div>
  </div>
</div>

<div class="toast-container" id="toastContainer"></div>

<script>
// State management
let accounts = [];
let editingIndex = null;
let darkMode = localStorage.getItem('darkMode') === 'true';
let notifiedAccounts = JSON.parse(localStorage.getItem('notifiedAccounts') || '[]');
let currentView = 'accounts';

// DOM Elements
const elements = {
  emailInput: document.getElementById("email"),
  startDateInput: document.getElementById("startDate"),
  durationInput: document.getElementById("duration"),
  addAccountBtn: document.getElementById("addAccount"),
  accountsTable: document.getElementById("accountsTable"),
  accountsTableBody: document.getElementById("accountsTableBody"),
  emptyState: document.getElementById("emptyState"),
  addFirstAccountBtn: document.getElementById("addFirstAccount"),
  editModal: document.getElementById("editModal"),
  editEmail: document.getElementById("editEmail"),
  editStartDate: document.getElementById("editStartDate"),
  editDuration: document.getElementById("editDuration"),
  saveEditBtn: document.getElementById("saveEditBtn"),
  cancelEditBtn: document.getElementById("cancelEditBtn"),
  modalClose: document.querySelector(".modal-close"),
  exportBtn: document.getElementById("exportBtn"),
  importFile: document.getElementById("importFile"),
  darkModeToggle: document.getElementById("darkModeToggle"),
  searchInput: document.getElementById("searchInput"),
  toastContainer: document.getElementById("toastContainer"),
  statusFilter: document.getElementById("statusFilter"),
  dashboardBtn: document.getElementById("dashboardBtn"),
  dashboardView: document.getElementById("dashboardView"),
  accountsView: document.getElementById("accountsView"),
  dashboardStats: document.getElementById("dashboardStats"),
  activeCount: document.getElementById("activeCount"),
  endingCount: document.getElementById("endingCount"),
  expiredCount: document.getElementById("expiredCount"),
  totalCount: document.getElementById("totalCount"),
  dashboardTable: document.getElementById("dashboardTable"),
  dashboardTableBody: document.getElementById("dashboardTableBody"),
  dashboardEmptyState: document.getElementById("dashboardEmptyState")
};

// Initialize the app
function init() {
  // Set current datetime as default for start date
  const now = new Date();
  const localDateTime = new Date(now.getTime() - now.getTimezoneOffset() * 60000).toISOString().slice(0, 16);
  elements.startDateInput.value = localDateTime;
  
  // Load data and apply dark mode if enabled
  loadData();
  setDarkMode(darkMode);
  renderAccounts();
  updateDashboard();
  
  // Set up event listeners
  setupEventListeners();
  
  // Start the countdown timer
  setInterval(updateTimers, 1000);
  
  // Check for notifications
  setInterval(checkNotifications, 30000);
  checkNotifications();
}

// Set up all event listeners
function setupEventListeners() {
  elements.addAccountBtn.addEventListener("click", addAccount);
  elements.addFirstAccountBtn.addEventListener("click", () => {
    elements.emailInput.focus();
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });
  elements.saveEditBtn.addEventListener("click", saveEdit);
  elements.cancelEditBtn.addEventListener("click", closeEditModal);
  elements.modalClose.addEventListener("click", closeEditModal);
  elements.exportBtn.addEventListener("click", exportAccounts);
  elements.importFile.addEventListener("change", importAccounts);
  elements.darkModeToggle.addEventListener("click", toggleDarkMode);
  elements.searchInput.addEventListener("input", filterAccounts);
  elements.statusFilter.addEventListener("change", filterAccounts);
  elements.dashboardBtn.addEventListener("click", toggleDashboardView);
  
  // Close modal when clicking outside
  elements.editModal.addEventListener("click", (e) => {
    if (e.target === elements.editModal) closeEditModal();
  });
}

// Toggle between dashboard and accounts view
function toggleDashboardView() {
  if (currentView === 'accounts') {
    elements.dashboardBtn.innerHTML = '<i class="fas fa-list"></i> Accounts';
    elements.accountsView.classList.remove('active');
    elements.dashboardView.classList.add('active');
    currentView = 'dashboard';
    updateDashboard();
  } else {
    elements.dashboardBtn.innerHTML = '<i class="fas fa-chart-pie"></i> Dashboard';
    elements.dashboardView.classList.remove('active');
    elements.accountsView.classList.add('active');
    currentView = 'accounts';
  }
}

// Update dashboard with stats and ending soon accounts
function updateDashboard() {
  // Calculate stats
  const active = accounts.filter(acc => getStatus(new Date(acc.endDate)) === 'status-active').length;
  const ending = accounts.filter(acc => getStatus(new Date(acc.endDate)) === 'status-ending').length;
  const expired = accounts.filter(acc => getStatus(new Date(acc.endDate)) === 'status-ended').length;
  const total = accounts.length;
  
  // Update stat cards
  elements.activeCount.textContent = active;
  elements.endingCount.textContent = ending;
  elements.expiredCount.textContent = expired;
  elements.totalCount.textContent = total;
  
  // Get accounts ending in next 24 hours
  const now = new Date();
  const endingSoon = accounts.filter(acc => {
    const endDate = new Date(acc.endDate);
    const diffHours = (endDate - now) / (1000 * 60 * 60);
    return diffHours <= 24 && diffHours > 0;
  });
  
  // Render ending soon accounts
  if (endingSoon.length === 0) {
    elements.dashboardEmptyState.style.display = "block";
    elements.dashboardTable.style.display = "none";
  } else {
    elements.dashboardEmptyState.style.display = "none";
    elements.dashboardTable.style.display = "table";
    
    let dashboardHTML = "";
    
    endingSoon.forEach(acc => {
      const endDate = new Date(acc.endDate);
      
      dashboardHTML += `
        <tr>
          <td>${acc.email}</td>
          <td>${formatDateTimeAMPM(endDate)}</td>
          <td class="time-left">${getTimeLeft(endDate)}</td>
          <td><span class="status-indicator status-ending">ending</span></td>
        </tr>
      `;
    });
    
    elements.dashboardTableBody.innerHTML = dashboardHTML;
  }
}

// Check for notifications (1 day before ending)
function checkNotifications() {
  const now = new Date();
  
  accounts.forEach(acc => {
    const endDate = new Date(acc.endDate);
    const diffHours = (endDate - now) / (1000 * 60 * 60);
    
    // If less than 24 hours remaining and not notified yet
    if (diffHours <= 24 && diffHours > 0 && !notifiedAccounts.includes(acc.email)) {
      showToast(`Trial for ${acc.email} is ending in less than 24 hours!`, "warning");
      notifiedAccounts.push(acc.email);
      localStorage.setItem('notifiedAccounts', JSON.stringify(notifiedAccounts));
    }
  });
}

// Toast notification system
function showToast(message, type = "info") {
  const toast = document.createElement("div");
  toast.className = `toast ${type}`;
  
  let icon = "info-circle";
  if (type === "success") icon = "check-circle";
  if (type === "error") icon = "exclamation-circle";
  if (type === "warning") icon = "exclamation-triangle";
  
  toast.innerHTML = `
    <i class="fas fa-${icon} toast-icon"></i>
    <div class="toast-message">${message}</div>
    <button class="toast-close">&times;</button>
  `;
  
  elements.toastContainer.appendChild(toast);
  
  // Add event listener to close button
  toast.querySelector(".toast-close").addEventListener("click", () => {
    toast.style.animation = "slideIn 0.3s ease reverse";
    setTimeout(() => toast.remove(), 300);
  });
  
  // Auto remove after 5 seconds
  setTimeout(() => {
    if (toast.parentNode) {
      toast.style.animation = "slideIn 0.3s ease reverse";
      setTimeout(() => toast.remove(), 300);
    }
  }, 5000);
}

// Dark mode functionality
function toggleDarkMode() {
  darkMode = !darkMode;
  setDarkMode(darkMode);
  localStorage.setItem('darkMode', darkMode);
}

function setDarkMode(enabled) {
  if (enabled) {
    document.body.classList.add("dark");
    elements.darkModeToggle.innerHTML = '<i class="fas fa-sun"></i>';
  } else {
    document.body.classList.remove("dark");
    elements.darkModeToggle.innerHTML = '<i class="fas fa-moon"></i>';
  }
}

// Account management functions
function addAccount() {
  const email = elements.emailInput.value.trim();
  const startDate = elements.startDateInput.value;
  const duration = parseInt(elements.durationInput.value);
  
  if (!email || !startDate || !duration) {
    showToast("Please fill all fields", "error");
    return;
  }
  
  if (!isValidEmail(email)) {
    showToast("Please enter a valid email address", "error");
    return;
  }
  
  const endDate = new Date(startDate);
  endDate.setDate(endDate.getDate() + duration);
  
  accounts.push({ 
    email, 
    startDate, 
    duration, 
    endDate: endDate.toISOString() 
  });
  
  saveData();
  renderAccounts();
  updateDashboard();
  
  // Reset form
  elements.emailInput.value = "";
  const now = new Date();
  const localDateTime = new Date(now.getTime() - now.getTimezoneOffset() * 60000).toISOString().slice(0, 16);
  elements.startDateInput.value = localDateTime;
  elements.durationInput.value = 30;
  
  showToast("Account added successfully", "success");
}

function isValidEmail(email) {
  const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  return re.test(email);
}

function renderAccounts() {
  if (accounts.length === 0) {
    elements.emptyState.style.display = "block";
    elements.accountsTable.style.display = "none";
    return;
  }
  
  elements.emptyState.style.display = "none";
  elements.accountsTable.style.display = "table";
  
  // Sort accounts by end date
  accounts.sort((a, b) => new Date(a.endDate) - new Date(b.endDate));
  
  let accountsHTML = "";
  
  accounts.forEach((acc, index) => {
    const startDate = new Date(acc.startDate);
    const endDate = new Date(acc.endDate);
    
    const totalDuration = endDate - startDate;
    const elapsed = new Date() - startDate;
    const progressPercent = Math.min(Math.max((elapsed / totalDuration) * 100, 0), 100);
    
    const statusClass = getStatus(endDate);
    let progressClass = 'progress-active';
    if (statusClass === 'status-ending') progressClass = 'progress-ending';
    if (statusClass === 'status-ended') progressClass = 'progress-ended';
    
    accountsHTML += `
      <tr data-email="${acc.email.toLowerCase()}" data-status="${statusClass.replace('status-', '')}">
        <td>${acc.email}</td>
        <td>${formatDateTimeAMPM(startDate)}</td>
        <td>${formatDateTimeAMPM(endDate)}</td>
        <td><span class="status-indicator ${statusClass}">${statusClass.replace("status-", "")}</span></td>
        <td class="time-left">${getTimeLeft(endDate)}</td>
        <td>
          <div class="progress-container">
            <div class="progress-bar ${progressClass}" style="width: ${progressPercent}%"></div>
          </div>
        </td>
        <td>
          <div class="action-buttons">
            <button class="icon-btn edit-account" data-index="${index}">
              <i class="fas fa-edit"></i>
            </button>
            <button class="icon-btn remove-account" data-index="${index}">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        </td>
      </tr>
    `;
  });
  
  elements.accountsTableBody.innerHTML = accountsHTML;
  
  // Add event listeners to action buttons
  document.querySelectorAll(".edit-account").forEach(btn => {
    btn.addEventListener("click", () => {
      const index = btn.getAttribute("data-index");
      openEditModal(index);
    });
  });
  
  document.querySelectorAll(".remove-account").forEach(btn => {
    btn.addEventListener("click", () => {
      const index = btn.getAttribute("data-index");
      removeAccount(index);
    });
  });
  
  // Apply filters
  filterAccounts();
}

function updateTimers() {
  document.querySelectorAll(".time-left").forEach(el => {
    const row = el.closest("tr");
    const email = row.getAttribute("data-email");
    const account = accounts.find(acc => acc.email.toLowerCase() === email);
    
    if (account) {
      const endDate = new Date(account.endDate);
      el.textContent = getTimeLeft(endDate);
      
      // Update progress bar
      const startDate = new Date(account.startDate);
      const totalDuration = endDate - startDate;
      const elapsed = new Date() - startDate;
      const progressPercent = Math.min(Math.max((elapsed / totalDuration) * 100, 0), 100);
      
      const progressBar = row.querySelector(".progress-bar");
      progressBar.style.width = `${progressPercent}%`;
      
      // Update status if needed
      const statusClass = getStatus(endDate);
      let progressClass = 'progress-active';
      if (statusClass === 'status-ending') progressClass = 'progress-ending';
      if (statusClass === 'status-ended') progressClass = 'progress-ended';
      
      progressBar.className = `progress-bar ${progressClass}`;
      
      const statusIndicator = row.querySelector(".status-indicator");
      statusIndicator.className = `status-indicator ${statusClass}`;
      statusIndicator.textContent = statusClass.replace("status-", "");
      
      // Update data attributes for filtering
      row.setAttribute("data-status", statusClass.replace('status-', ''));
    }
  });
  
  // Update dashboard if it's active
  if (currentView === 'dashboard') {
    updateDashboard();
  }
}

function filterAccounts() {
  const searchTerm = elements.searchInput.value.toLowerCase();
  const statusFilter = elements.statusFilter.value;
  
  document.querySelectorAll("#accountsTableBody tr").forEach(row => {
    const email = row.getAttribute("data-email");
    const status = row.getAttribute("data-status");
    
    const matchesSearch = email.includes(searchTerm);
    const matchesStatus = statusFilter === 'all' || status === statusFilter;
    
    if (matchesSearch && matchesStatus) {
      row.style.display = "table-row";
    } else {
      row.style.display = "none";
    }
  });
}

function getTimeLeft(endDate) {
  const now = new Date();
  const diff = endDate - now;
  
  if (diff <= 0) return "Expired";
  
  const days = Math.floor(diff / (1000 * 60 * 60 * 24));
  const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
  const minutes = Math.floor((diff / (1000 * 60)) % 60);
  const seconds = Math.floor((diff / 1000) % 60);
  
  return `${days}d ${hours}h ${minutes}m ${seconds}s`;
}

function getStatus(endDate) {
  const now = new Date();
  if (endDate < now) return "status-ended";
  
  const diffDays = (endDate - now) / (1000 * 60 * 60 * 24);
  if (diffDays <= 1) return "status-ending";
  
  return "status-active";
}

// Format date with AM/PM
function formatDateTimeAMPM(date) {
  const options = { 
    year: 'numeric', 
    month: 'short', 
    day: 'numeric',
    hour: 'numeric',
    minute: '2-digit',
    hour12: true
  };
  return date.toLocaleString(undefined, options);
}

function openEditModal(index) {
  editingIndex = index;
  const acc = accounts[index];
  
  elements.editEmail.value = acc.email;
  elements.editStartDate.value = acc.startDate;
  elements.editDuration.value = acc.duration;
  
  elements.editModal.style.display = "flex";
}

function closeEditModal() {
  elements.editModal.style.display = "none";
  editingIndex = null;
}

function saveEdit() {
  if (editingIndex === null) return;
  
  accounts[editingIndex].email = elements.editEmail.value;
  accounts[editingIndex].startDate = elements.editStartDate.value;
  accounts[editingIndex].duration = parseInt(elements.editDuration.value);
  
  const endDate = new Date(elements.editStartDate.value);
  endDate.setDate(endDate.getDate() + accounts[editingIndex].duration);
  accounts[editingIndex].endDate = endDate.toISOString();
  
  saveData();
  renderAccounts();
  updateDashboard();
  closeEditModal();
  
  showToast("Account updated successfully", "success");
}

function removeAccount(index) {
  if (confirm("Are you sure you want to remove this account?")) {
    // Remove from notified accounts if present
    const email = accounts[index].email;
    notifiedAccounts = notifiedAccounts.filter(acc => acc !== email);
    localStorage.setItem('notifiedAccounts', JSON.stringify(notifiedAccounts));
    
    accounts.splice(index, 1);
    saveData();
    renderAccounts();
    updateDashboard();
    showToast("Account removed", "info");
  }
}

function exportAccounts() {
  const blob = new Blob([JSON.stringify(accounts, null, 2)], { type: "application/json" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "premium_trial_accounts.json";
  a.click();
  URL.revokeObjectURL(url);
  
  showToast("Accounts exported successfully", "success");
}

function importAccounts(e) {
  const file = e.target.files[0];
  if (!file) return;
  
  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      const imported = JSON.parse(e.target.result);
      if (Array.isArray(imported)) {
        accounts = imported;
        // Reset notified accounts when importing
        notifiedAccounts = [];
        localStorage.setItem('notifiedAccounts', JSON.stringify(notifiedAccounts));
        saveData();
        renderAccounts();
        updateDashboard();
        showToast("Accounts imported successfully", "success");
      } else {
        showToast("Invalid file format", "error");
      }
    } catch (err) {
      showToast("Error reading file", "error");
    }
  };
  reader.readAsText(file);
  e.target.value = "";
}

function saveData() {
  localStorage.setItem("accounts", JSON.stringify(accounts));
}

function loadData() {
  const data = localStorage.getItem("accounts");
  if (data) {
    try {
      accounts = JSON.parse(data);
    } catch (e) {
      accounts = [];
    }
  }
}

// Initialize the app when DOM is loaded
document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>